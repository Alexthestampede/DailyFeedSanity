Language Override System Flow
=============================

User Actions (via Config Wizard)
│
├── [9] View Language Overrides
│   │
│   └─→ Reads: feed_language_overrides.txt
│       │
│       ├─→ File exists? → Display formatted table
│       └─→ File missing? → Show help message
│
├── [10] Add Language Override
│   │
│   ├─→ Prompt for domain/URL
│   │   ├─→ Parse URL → Extract domain + path
│   │   └─→ Example: "https://macitynet.it/feed" → "macitynet.it"
│   │
│   ├─→ Prompt for language
│   │   └─→ Auto-capitalize → "italian" → "Italian"
│   │
│   ├─→ Check existing overrides
│   │   ├─→ Exists? → Prompt to replace
│   │   └─→ New? → Add to list
│   │
│   └─→ Write to: feed_language_overrides.txt
│       └─→ Preserve comments and formatting
│
├── [11] Remove Language Override
│   │
│   ├─→ Read: feed_language_overrides.txt
│   │
│   ├─→ Display numbered list
│   │   │
│   │   └─→ [1] macitynet.it → Italian
│   │       [2] 9to5mac.com → English
│   │       [3] ansa.it → Italian
│   │
│   ├─→ Prompt for selection (or 'c' to cancel)
│   │
│   └─→ Rewrite file without selected override
│       └─→ Preserve comments
│
└── [12] Clear Language Cache
    │
    ├─→ Confirm with user
    │   └─→ "Are you sure? [y/N]"
    │
    └─→ Delete: .feed_language_cache.json
        └─→ Forces re-detection on next run


RSS Processor Flow (Main System)
=================================

For each feed URL:
│
├─→ 1. Check: feed_language_overrides.txt
│   │   (Manual overrides - HIGHEST PRIORITY)
│   │
│   ├─→ Match found? → Use this language
│   │   └─→ Example: "macitynet.it" → Italian
│   │
│   └─→ No match? → Continue to step 2
│
├─→ 2. Check: LANGUAGE_OVERRIDES in config.py
│   │   (Hardcoded config)
│   │
│   ├─→ Match found? → Use this language
│   └─→ No match? → Continue to step 3
│
├─→ 3. Check: .feed_language_cache.json
│   │   (Previously detected languages)
│   │
│   ├─→ Match found? → Use cached language
│   └─→ No match? → Continue to step 4
│
├─→ 4. AI Detection
│   │   (Automatic detection via AI provider)
│   │
│   ├─→ Sample feed content
│   ├─→ Send to AI: "What language is this?"
│   ├─→ AI responds: "Italian"
│   ├─→ Cache result in: .feed_language_cache.json
│   └─→ Use detected language
│
└─→ 5. Default: None
    │   (No language override needed)
    │
    └─→ Continue processing without language specification


File Relationships
==================

feed_language_overrides.txt (Manual - Highest Priority)
│
│   Format: domain = Language
│   Example:
│   ┌─────────────────────────────────────┐
│   │ # Italian tech news sites           │
│   │ macitynet.it = Italian              │
│   │ feedburner.com/psblog = Italian     │
│   │                                     │
│   │ # English tech news                 │
│   │ 9to5mac.com = English               │
│   └─────────────────────────────────────┘
│
├─→ Managed by: Config Wizard
├─→ Read by: RSS Processor
└─→ Gitignored: Yes (user-specific)


.feed_language_cache.json (Auto-generated Cache)
│
│   Format: JSON dictionary
│   Example:
│   ┌─────────────────────────────────────┐
│   │ {                                   │
│   │   "ansa.it": "Italian",             │
│   │   "lemonde.fr": "French",           │
│   │   "spiegel.de": "German"            │
│   │ }                                   │
│   └─────────────────────────────────────┘
│
├─→ Created by: RSS Processor (AI detection)
├─→ Cleared by: Config Wizard [12]
├─→ Read by: RSS Processor
└─→ Gitignored: Yes (auto-generated)


feed_language_overrides.example.txt (Template)
│
│   Example file with instructions
│
├─→ Copy to: feed_language_overrides.txt
├─→ Edit with: Your overrides
└─→ Gitignored: No (example template)


Priority Diagram
================

    ┌─────────────────────────────────────────────────────┐
    │         Feed URL: macitynet.it/feed                 │
    └────────────────────┬────────────────────────────────┘
                         │
                         ▼
    ┌────────────────────────────────────────────────────┐
    │  1. Manual Override (feed_language_overrides.txt)  │
    │     ✓ FOUND: macitynet.it → Italian                │
    │     ★ HIGHEST PRIORITY - USE THIS! ★               │
    └────────────────────────────────────────────────────┘
                         │
                         ▼
                  ┌──────────┐
                  │ Italian  │
                  └──────────┘
                         │
                         ▼
    ┌────────────────────────────────────────────────────┐
    │      Process feed with Italian language            │
    │      AI will use Italian for summaries             │
    └────────────────────────────────────────────────────┘


    If no manual override found:

    ┌─────────────────────────────────────────────────────┐
    │         Feed URL: lemonde.fr/feed                   │
    └────────────────────┬────────────────────────────────┘
                         │
                         ▼
    ┌────────────────────────────────────────────────────┐
    │  1. Manual Override: ✗ Not found                   │
    └────────────────────┬───────────────────────────────┘
                         │
                         ▼
    ┌────────────────────────────────────────────────────┐
    │  2. Hardcoded Config: ✗ Not found                  │
    └────────────────────┬───────────────────────────────┘
                         │
                         ▼
    ┌────────────────────────────────────────────────────┐
    │  3. Cache (.feed_language_cache.json)              │
    │     ✓ FOUND: lemonde.fr → French                   │
    │     Use cached value                               │
    └────────────────────────────────────────────────────┘
                         │
                         ▼
                  ┌──────────┐
                  │  French  │
                  └──────────┘


    If no cache found:

    ┌─────────────────────────────────────────────────────┐
    │         Feed URL: spiegel.de/feed                   │
    └────────────────────┬────────────────────────────────┘
                         │
                         ▼
    ┌────────────────────────────────────────────────────┐
    │  1-3: No overrides or cache found                  │
    └────────────────────┬───────────────────────────────┘
                         │
                         ▼
    ┌────────────────────────────────────────────────────┐
    │  4. AI Detection                                   │
    │     Sample feed content...                         │
    │     Send to AI provider...                         │
    │     AI Response: "German"                          │
    │     Cache result for next time                     │
    └────────────────────────────────────────────────────┘
                         │
                         ▼
                  ┌──────────┐
                  │  German  │
                  └──────────┘
                         │
                         ▼
    ┌────────────────────────────────────────────────────┐
    │      Save to cache for future runs                 │
    │      .feed_language_cache.json updated             │
    └────────────────────────────────────────────────────┘


Integration with Wizard
========================

    Config Wizard Menu
    ┌────────────────────────────────────────────────┐
    │  [1] Change AI provider                        │
    │  [2] Change text model                         │
    │  [3] Change vision model                       │
    │  [4] Add RSS feed                              │
    │  [5] Remove RSS feed                           │
    │  [6] View all feeds                            │
    │  [7] Test AI connection                        │
    │  [8] Reset configuration                       │
    │  ─────────────────────────────────────────     │
    │  [9] View language overrides     ◄─┐           │
    │ [10] Add language override         │           │
    │ [11] Remove language override      │  NEW!     │
    │ [12] Clear language cache         ─┘           │
    │  ─────────────────────────────────────────     │
    │ [13] Exit                                      │
    └────────────────────────────────────────────────┘
              │
              │
              ▼
    ┌────────────────────────────────────────────────┐
    │  Language Override Functions                   │
    │                                                │
    │  view_language_overrides()                     │
    │    → Read and display overrides                │
    │                                                │
    │  add_language_override()                       │
    │    → Add new override to file                  │
    │                                                │
    │  remove_language_override()                    │
    │    → Remove override from file                 │
    │                                                │
    │  clear_language_cache()                        │
    │    → Delete cache file                         │
    └────────────────────────────────────────────────┘
              │
              │
              ▼
    ┌────────────────────────────────────────────────┐
    │  File Operations                               │
    │                                                │
    │  Read:  feed_language_overrides.txt            │
    │  Write: feed_language_overrides.txt            │
    │  Delete: .feed_language_cache.json             │
    │                                                │
    │  Features:                                     │
    │  • Preserve comments                           │
    │  • Validate input                              │
    │  • Error handling                              │
    │  • User confirmation                           │
    └────────────────────────────────────────────────┘
